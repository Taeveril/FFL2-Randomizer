import mmap
import FFL2R_io
import FFL2R_data

MAXINT = 255

class GamePrep:
    def __init__(self):
        pass

    def newTitleScreen(menuBlock:FFL2R_io.ScriptBlock, VERSION:float, seed:int):
        def infoPatchList(VERSION:float, seed:int)->list:
            def hexList(info:str, maxLength:int)->list:
                hexes = []
                for digit in info:
                    if digit.isdigit():
                        hexes.append(int(digit) + 0xB0)
                    else: #float w/ dot
                        hexes.append(0xF0)
                while len(hexes) < maxLength:
                    hexes.insert(0, 0xFF)
                return hexes

            finalList = [0x36, 0x03, 0xCB, 0x59, 0xD7, 0x81, 0xDC, 0xED, 0x53, 0xFF] #"Randomizer "
            finalList.extend(hexList(str(VERSION), 4))
            finalList.extend([0x05, 0x36, 0x03, 0xCC, 0xD8, 0x8F, 0xFF]) #"Seed "
            finalList.extend(hexList(str(seed), 10))
            finalList.extend([0x06, 0xFF, 0xFF, 0x2E, 0xFF, 0xCC, 0xE7, 0x6E, 0x54]) #truncate start/continue
            return finalList


        titleInfo = infoPatchList(VERSION, seed)
        menuBlock.replaceScript(20, [0x00, 0x0A, 0x14, 0x08] + titleInfo + [0x2E, 0xFF, 0xBC, 0x65, 0xE7, 0x56, 0xE8, 0xD8, 
                                                                                0x06, 0xFF, 0xA2, 0xB1, 0xB9, 0xB9, 0xB1, 0xFF, 
                                                                                0xCC, 0xCA, 0xCE, 0xBA, 0xCB, 0xBE, 0xFF, 0xCC, 
                                                                                0xC8, 0xBF, 0xCD, 0x05, 0xC5, 0xC2, 0xBC, 0xBE, 
                                                                                0xC7, 0xCC, 0xBE, 0xBD, 0xFF, 0xBB, 0xD2, 0xFF, 
                                                                                0xC7, 0xC2, 0xC7, 0xCD, 0xBE, 0xC7, 0xBD, 0xC8, 
                                                                                0x00])

    def leonsText(magi:int) -> list:
        match magi:
            case 0x00:
                magiString=[0xC9, 0x84, 0x53] #power
            case 0x01:
                magiString=[0xCC, 0xE3, 0xD8, 0x8F] #speed
            case 0x02:
                magiString=[0xC6, 0x59, 0xD4] #mana
            case 0x03:
                magiString=[0xBD, 0xD8, 0xD9, 0x8B, 0x80] #defense
            case 0x04:
                magiString=[0xBF, 0xDC, 0x5A] #fire
            case 0x05:
                magiString=[0xC2, 0xD6, 0xD8] #ice
            case 0x06:
                magiString=[0xCD, 0xDB, 0xE8, 0x7C, 0x53] #thunder
            case 0x07:
                magiString=[0xC9, 0xE2, 0x5F, 0x65] #poison
            case 0x08:
                magiString=[0xC6, 0x89, 0xE0, 0xE8, 0x92] #masmune
            case 0x09:
                magiString=[0xBA, 0xD8, 0xDA, 0x5F] #aegis
            case 0x0B:
                magiString=[0xC1, 0x75, 0xE5, 0xE7] #heart
            case 0x0C:
                magiString=[0xC9, 0xD8, 0xDA, 0x89, 0x8E] #pegasus
            case 0x0D:
                magiString=[0xC9, 0xE5, 0x5F, 0xE0] #prism
        magiString.append(0xF3)
        while len(magiString) < 6:
            magiString.append(0xFF)
        newScriptText = [0x06, 0xCB, 0xD8, 0xD6, 0xD8, 0xDC, 0x76, 0x57, 0x9E] + magiString +   [0x0B, 0x0D, 0x12, 0x11, 
                         0x10, 0x19, 0xF6, 0x33, 0x00, 0xFF, 0x19, 0xF6, 0x11, 0x00, 0xF1, 0x02, 0xFF, 0x19, 0xF6, 0x03, 
                         0x00, 0xFF, 0xC5, 0xD8, 0x65, 0xF5, 0xC9, 0x98, 0x89, 0xD8, 0xF1, 0xF1, 0x06, 0xFF, 0xBF, 0x66, 
                         0xDA, 0xDC, 0x76, 0x64, 0x4E, 0xF1, 0xF3, 0xF3, 0x11, 0x04, 0x0D, 0x19, 0xF0, 0x12, 0x19, 0xF6, 
                         0x13, 0x00, 0xF2, 0x13, 0xFF, 0x19, 0xF6, 0x21, 0x00, 0xFF, 0x13, 0x11, 0x14, 0x08, 0x06, 0x10, 
                         0x20, 0x1F, 0x00, 0xF5, 0xC5, 0xD8, 0x65, 0x63, 0x5D, 0x98, 0x58, 0xFF, 0x06, 0x9E] + magiString + [0x00]

        return newScriptText

    def newDropScripts(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock):
        #gives Ashura and Venus new magi drop scripts
        scriptingBlock1.addNewScript([0x19, 0x0A, 0x00, 0x19, 0x0A, 0x01, 0x19, 0x0A, 0x02, 0x19, 0x0A, 0x04, 0x19, 0x0A, 0x05, 0x19, 0x0A, 
                                      0x06, 0x19, 0x0A, 0x07, 0x00])
        scriptingBlock1.addNewScript([0x19, 0x0A, 0x00, 0x19, 0x0A, 0x01, 0x19, 0x0A, 0x02, 0x19, 0x0A, 0x04, 0x19, 0x0A, 0x05, 0x19, 0x0A, 
                                      0x06, 0x19, 0x0A, 0x07, 0x00])
        #ashura
        scriptingBlock2.script[77].scriptData[348] = 0xC0
        #venus
        scriptingBlock1.script[43].scriptData[105] = 0xC1

    def memoRemove(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock, menuBlock:FFL2R_io.ScriptBlock, 
                   memoBlock:FFL2R_io.ScriptBlock, romData:mmap):
        def clearMemoSetCalls(block:FFL2R_io.ScriptBlock):
            c1 = block.findScriptsByBytes([0x18])
            c2 = [x for x in c1 if block.script[x[0]].scriptData[x[1]-1] not in range(0x12, 0x1b)]
            c2.reverse()
            for x in c2:
                block.removeFromScript(x[0], x[1], x[1]+2)

        blocks = ((0x54c4, 4), (0x3e038,72))
        for addr in blocks:
            for i in range(0,addr[1]):
                romData[addr[0]+i] = 0x0
        menuBlock.removeFromScript(1,31,37)
        menuBlock.script[1].scriptData[3]=0x0d
        for x in FFL2R_data.GameData.noMemoCalls:
            memoBlock.replaceScript(x, [0x0])
   
        clearMemoSetCalls(scriptingBlock1)
        clearMemoSetCalls(scriptingBlock2)

    def kiShrineCleanup(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock, mapHeaders:FFL2R_io.MapData):
        scriptingBlock1.addNewScript([0xba, 0xe6, 0xe6, 0x5f, 0xe7, 0x59, 0xe7, 0xf5, 0x8c, 0x61, 0xd4, 0x76, 0x06, 0xe6, 0x81, 0x85, 0x70, 0x6b, 0x7e, 0x66, 0x6f, 
                                      0x55, 0xf3, 0x00])
        scriptingBlock2.insertIntoScript(50, 0, [0x15, 0xc, 0x0, 0x19, 0x0, 0xc2, 0x0])
        mapHeaders.delNPC(11, 7)
        mapHeaders.header[11].npcs = [[0x00, 0x0e, 0x24, 0x25, 0x25, 0x11], [0x00, 0x0e, 0x28, 0x25, 0x27, 0x21], [0x00, 0x0e, 0x24, 0xa2, 0x29, 0x31], 
                                      [0x01, 0x0c, 0x14, 0x13, 0x2d, 0x51], [0x01, 0xde, 0x13, 0x0c, 0x2e, 0xd1], [0x01, 0x06, 0x12, 0xcc, 0x38, 0xe1], 
                                      [0x01, 0xde, 0x52, 0xcc, 0x32, 0xe1], [0x03, 0x5f, 0x12, 0xcc, 0x33, 0xe1], [0x01, 0x0e, 0x10, 0x11, 0x2b, 0x41], 0xff]
        scriptingBlock2.insertIntoScript(37, 0, [0x15, 0x1, 0xde, 0x19, 0x1, 0x26, 0x0])
        scriptingBlock2.insertIntoScript(39, 0, [0x15, 0x1, 0xde, 0x19, 0x1, 0x28, 0x0])
        scriptingBlock2.insertIntoScript(41, 0, [0x15, 0x1, 0xde, 0x19, 0x1, 0x2a, 0x0])
        scriptingBlock2.insertIntoScript(43, 0, [0x15, 0x1, 0xde, 0x19, 0x1, 0x2c, 0x0])
        scriptingBlock2.replaceScript(49, [0x0])
        mapHeaders.header[47].npcs[0] = [0x4c, 0x6, 0xdb, 0xc5, 0x0, 0xf1]
        scriptingBlock1.replaceScript(30, [0x0]) 
        scriptingBlock1.insertIntoScript(31, 5, [0x12, 0xc])
        scriptingBlock1.insertIntoScript(32, 5, [0x12, 0xc])
        scriptingBlock1.insertIntoScript(33, 5, [0x12, 0xc])
        scriptingBlock1.insertIntoScript(34, 5, [0x12, 0xc])
        scriptingBlock1.insertIntoScript(35, 5, [0x12, 0xc])
        scriptingBlock1.insertIntoScript(36, 5, [0x12, 0xc])
        scriptingBlock1.replaceScript(37, [0x19, 0xa, 0x3, 0x12, 0x3, 0x12, 0xc, 0x12, 0x10, 0x14, 0x1, 0xf, 0x10, 0x14, 0xc, 0x0, 0xb, 0xd, 0x19, 0x5, 0xb0, 0x19, 0x7, 
                                           0x3, 0x0])
        scriptingBlock2.script[89].scriptData[37] = 0xc
        mapHeaders.header[54].npcs = [[0x4c, 0x77, 0x1a, 0x12, 0x59, 0x91], [0xc, 0x78, 0x5a, 0xcf, 0x25, 0xa0], 0xff]
        mapHeaders.header[22].npcs[0][1] = 0x55
        mapHeaders.header[38].npcs[0] = [0x42, 0x4, 0x15, 0xc5, 0x4d, 0x91]
        mapHeaders.header[38].npcs[1] = [0x42, 0x4, 0x56, 0xc5, 0x4d, 0x91]
        mapHeaders.header[38].npcs[2] = [0x42, 0x4, 0x95, 0xc6, 0x4d, 0x91]
        mapHeaders.header[38].npcs[3] = [0x42, 0x4, 0xd6, 0xc6, 0x4d, 0x91]
        scriptingBlock2.replaceScript(77, [0x19, 0x7, 0x12, 0xba, 0x93, 0x7d, 0xd4, 0xf5, 0xc1, 0xba, 0xf3, 0xff, 0xc1, 0xba, 0xf3, 0x6, 0xff, 0xd0, 0xd8, 
                                           0x67, 0xef, 0x61, 0xd8, 0x67, 0xe2, 0xf0, 0x6, 0x8c, 0x5e, 0x89, 0x58, 0xd5, 0x55, 0x54, 0x5d, 0x6, 0x63, 0x8b, 
                                           0x57, 0xe6, 0x81, 0xd8, 0x65, 0x4e, 0x5d, 0x6, 0x4f, 0xd8, 0x67, 0x6f, 0x55, 0xf1, 0x4f, 0x6a, 0xe7, 0xf1, 0x6, 
                                           0x9c, 0x72, 0xe0, 0x59, 0x58, 0xdf, 0x5a, 0xd4, 0xd7, 0xec, 0x6, 0x64, 0xdc, 0xd6, 0x91, 0xe1, 0xdc, 0xed, 0x8f, 
                                           0x58, 0x7c, 0x6, 0x5e, 0x8b, 0x54, 0x56, 0x5d, 0xff, 0xc4, 0xdc, 0x77, 0x6, 0x74, 0xe2, 0xd7, 0xec, 0xf3, 0x6, 
                                           0x20, 0x1f, 0x0, 0xf5, 0xd0, 0x6a, 0x54, 0xd7, 0xdc, 0x57, 0x6d, 0xe8, 0x6, 0x83, 0x5b, 0x5d, 0x61, 0x53, 0xf4, 
                                           0xf3, 0x6, 0xba, 0x93, 0x7d, 0xd4, 0xf5, 0xc4, 0xdc, 0x5e, 0x89, 0x74, 0x66, 0x73, 0xea, 0x87, 0xdb, 0x9c, 0xba, 
                                           0xc0, 0x79, 0x56, 0x61, 0x53, 0x6, 0x74, 0xe2, 0xd7, 0x72, 0xea, 0x70, 0xd6, 0xdb, 0x62, 0xd4, 0x76, 0x6, 0x61, 
                                           0x53, 0x4f, 0x51, 0xff, 0xe3, 0x84, 0x53, 0x69, 0xd9, 0x6, 0x61, 0x75, 0xdf, 0x56, 0xda, 0xf0, 0x6, 0x8c, 0x62, 
                                           0x85, 0x4f, 0xdb, 0xe2, 0x80, 0x9c, 0xba, 0xc0, 0xc2, 0x6, 0x58, 0x7c, 0x63, 0x51, 0x7e, 0xd4, 0xdc, 0xdf, 0xe6, 
                                           0xf3, 0xf3, 0x6, 0xff, 0xf1, 0xf1, 0xc4, 0xdc, 0x67, 0x56, 0x9b, 0xb2, 0x74, 0xdc, 0xe5, 0xd7, 0x52, 0xea, 0x87, 
                                           0xdb, 0xff, 0xb1, 0x63, 0x5d, 0x92, 0xf1, 0xf1, 0x6, 0xff, 0xd0, 0xd8, 0x67, 0xf1, 0xf1, 0xff, 0xc7, 0x84, 0x8c, 
                                           0x62, 0x85, 0x6, 0x6f, 0x55, 0xe5, 0x52, 0x59, 0x57, 0x50, 0x60, 0xee, 0x67, 0x64, 0xd4, 0xde, 0x4e, 0x87, 0xff, 
                                           0xb3, 0x74, 0xdc, 0xe5, 0xd7, 0xe6, 0xf3, 0xf3, 0x20, 0x1f, 0x0, 0xf5, 0xf1, 0xf1, 0xff, 0xc7, 0xd8, 0x76, 0xe5, 
                                           0xf3, 0xf3, 0xb, 0xd, 0x9, 0x83, 0x37, 0x19, 0x7, 0xc, 0x3e, 0xba, 0x93, 0x7d, 0xd4, 0xf5, 0xc7, 0xe2, 0xf1, 
                                           0xff, 0xc7, 0xe2, 0xf3, 0xf3, 0x6, 0xff, 0xf1, 0x8c, 0xff, 0xf1, 0x83, 0x65, 0xee, 0x54, 0xf1, 0x6, 0xff, 0xff, 
                                           0xf1, 0x5e, 0x59, 0xe1, 0x7b, 0xf1, 0x83, 0xdc, 0xd8, 0xf1, 0xff, 0xf1, 0x11, 0x30, 0xba, 0xcb, 0xcb, 0xc0, 
                                           0xc1, 0xf3, 0x11, 0x1, 0xd, 0x14, 0x2, 0x5, 0x10, 0x19, 0x0, 0xc0, 0xd, 0x19, 0x5, 0x4a, 0x10, 0x19, 0xf1, 0x3, 
                                           0xff, 0x1f, 0x4, 0xf5, 0xc2, 0xee, 0x76, 0x83, 0x65, 0xd8, 0x6, 0x5e, 0x6a, 0x54, 0x79, 0xea, 0x59, 0x7f, 0x57, 
                                           0x5d, 0xf0, 0x6, 0xff, 0xcc, 0xd8, 0x4e, 0x6d, 0xe8, 0xf3, 0x6, 0x6, 0x36, 0x3, 0x1f, 0x4, 0x8a, 0xd8, 0xd9, 
                                           0xe7, 0xf0, 0xb, 0xd, 0x14, 0x2, 0x6, 0x14, 0x0, 0x0, 0x10, 0x19, 0xf1, 0x0, 0xff, 0x20, 0x1f, 0x5, 0xf5, 0xc4, 
                                           0xdc, 0x64, 0x8e, 0x54, 0x95, 0x6, 0x5c, 0x73, 0x7b, 0xe7, 0x91, 0xe8, 0xd5, 0x98, 0xf3, 0x6, 0xff, 0xc5, 0x85, 
                                           0x77, 0x62, 0x5b, 0x5d, 0x61, 0x53, 0xf3, 0xb, 0xd, 0x14, 0xe, 0x2, 0x12, 0x10, 0x0])
        mapHeaders.header[41].npcs[4] = [0x3, 0x0, 0x5f, 0x8b, 0x53, 0xd1]
        scriptingBlock2.replaceScript(83, [0x46, 0x20, 0x1f, 0x5, 0xf5, 0xbd, 0xf1, 0xff, 0xbd, 0xd4, 0xd7, 0xf3, 0xf3, 0x6, 0x19, 0x7, 0xa, 0xbf, 0x60, 
                                           0x51, 0xe5, 0xf5, 0xce, 0xdb, 0xf4, 0xff, 0x20, 0x1f, 0x5, 0xff, 0xf1, 0xf4, 0x6, 0x20, 0x1f, 0x5, 0xf5, 0xd2, 
                                           0x75, 0xdb, 0xf3, 0xf3, 0x6, 0xff, 0xcb, 0xd8, 0x6c, 0xe0, 0x95, 0x68, 0x6c, 0xf4, 0xf3, 0x6, 0xbf, 0x60, 0x51, 
                                           0xe5, 0xf5, 0xc8, 0xd9, 0x7a, 0x55, 0xe5, 0x80, 0xf3, 0x6, 0xff, 0xf1, 0xff, 0xc8, 0xdb, 0xef, 0xff, 0x20, 0x1f, 
                                           0x5, 0xff, 0xf1, 0xf1, 0x6, 0xff, 0xc1, 0x84, 0x77, 0x9c, 0x81, 0xf4, 0x6, 0x20, 0x1f, 0x5, 0xf5, 0xcc, 0x51, 
                                           0x77, 0x7e, 0x56, 0xd8, 0xf3, 0x6, 0xff, 0xf1, 0xff, 0xd0, 0xd4, 0x87, 0x56, 0x9b, 0xdb, 0x81, 0xd8, 0xf0, 0x6, 
                                           0xff, 0xc5, 0x85, 0x77, 0x62, 0x5b, 0xdb, 0x81, 0xd8, 0x6, 0x4f, 0xe2, 0xda, 0x85, 0x51, 0xe5, 0xef, 0xff, 0xbd, 
                                           0xd4, 0xd7, 0xf3, 0x6, 0xbf, 0x60, 0x51, 0xe5, 0xf5, 0xff, 0xf1, 0xff, 0xc7, 0x5b, 0xf1, 0x6, 0x8c, 0x7a, 0x59, 
                                           0xee, 0x54, 0xec, 0x85, 0xf0, 0x6, 0x20, 0x1f, 0x5, 0xf5, 0xbf, 0x66, 0x9c, 0xba, 0xc0, 0xc2, 0xf4, 0x6, 0xff, 
                                           0xbb, 0x86, 0xff, 0xf1, 0xff, 0xd0, 0x4e, 0xd7, 0xd8, 0xd9, 0x75, 0x7f, 0x57, 0xba, 0x93, 0x7d, 0xd4, 0xf3, 0x6, 
                                           0xbf, 0x60, 0x51, 0xe5, 0xf5, 0x99, 0x53, 0x4e, 0x6e, 0xd8, 0x6, 0x64, 0x66, 0x4e, 0x8d, 0x4f, 0xdb, 0xe2, 0x80, 
                                           0x6, 0x8a, 0xdc, 0xde, 0x4e, 0xba, 0x93, 0x7d, 0x7b, 0xf1, 0x6, 0x62, 0xe2, 0x56, 0x9b, 0xd4, 0xd9, 0x7f, 0x68, 
                                           0xc6, 0xba, 0xc0, 0xc2, 0xf0, 0x20, 0x1f, 0x5, 0xf5, 0xc6, 0xba, 0xc0, 0xc2, 0xf1, 0xff, 0xd0, 0xd8, 0xee, 0x76, 
                                           0x6, 0x62, 0xe2, 0x54, 0xe6, 0x81, 0xd8, 0xf3, 0xff, 0xc1, 0x53, 0xd8, 0xf3, 0xf3, 0x6, 0xbf, 0x60, 0x51, 0xe5, 
                                           0xf5, 0xd2, 0x55, 0xee, 0x5a, 0x6, 0x62, 0x60, 0x51, 0xe5, 0x56, 0x9b, 0x50, 0xd8, 0xe0, 0xef, 0x6, 0x4f, 0xe2, 
                                           0xe2, 0xf4, 0xf3, 0x6, 0xff, 0x99, 0x8b, 0xef, 0x4f, 0xd4, 0xde, 0x4e, 0x50, 0x5f, 0xf3, 0x6, 0xb, 0xd, 0x19, 
                                           0xa, 0x0, 0x6, 0xbf, 0x60, 0x51, 0xe5, 0xf5, 0xc7, 0xe2, 0xd5, 0xe2, 0xd7, 0xec, 0x6, 0x5e, 0x55, 0xdf, 0x57, 
                                           0xdc, 0xe0, 0xd4, 0xda, 0x56, 0xd8, 0x6, 0x4f, 0x6a, 0x54, 0xde, 0xdc, 0xd7, 0x52, 0xdf, 0xdc, 0xde, 0xd8, 0x6, 
                                           0x6f, 0x55, 0x61, 0xd4, 0x76, 0x63, 0xe8, 0xd6, 0xdb, 0x6, 0x58, 0x4f, 0x70, 0x6b, 0xf0, 0x6, 0x20, 0x1f, 0x5, 
                                           0xf5, 0xc2, 0xee, 0xe0, 0x90, 0xe2, 0xe7, 0x6, 0x58, 0xff, 0xde, 0xdc, 0x57, 0x59, 0xec, 0xe0, 0x66, 0xd8, 0xf0, 
                                           0x6, 0xbf, 0x60, 0x51, 0xe5, 0xf5, 0xd0, 0xd8, 0xee, 0x67, 0x64, 0xd8, 0x85, 0x6, 0x58, 0xda, 0xd4, 0x56, 0x58, 
                                           0x52, 0x9d, 0x6b, 0x58, 0xe6, 0x6, 0x5e, 0x4e, 0x71, 0x58, 0xd9, 0x7f, 0x68, 0xc6, 0xba, 0xc0, 0xc2, 0xf0, 0x8c, 
                                           0xee, 0x67, 0x7a, 0x81, 0x4e, 0xdb, 0x81, 0xd8, 0x6, 0x5e, 0x87, 0xdb, 0x6f, 0x55, 0x4f, 0x51, 0xe1, 0xf0, 0x6, 
                                           0x20, 0x1f, 0x5, 0xf5, 0xc9, 0x91, 0xe0, 0x5f, 0xd8, 0xf4, 0x6, 0xbf, 0x60, 0x51, 0xe5, 0xf5, 0xf1, 0xf1, 0xff, 
                                           0xd2, 0xd8, 0xe6, 0xf0, 0x6, 0x8c, 0xff, 0xc9, 0x91, 0xe0, 0x5f, 0xd8, 0xf0, 0x6, 0x14, 0x3, 0x1, 0x10, 0x20, 
                                           0x1f, 0x5, 0xf5, 0xc8, 0xde, 0xd4, 0xec, 0xef, 0xff, 0xbd, 0xd4, 0x57, 0xf1, 0xf1, 0x6, 0xff, 0xf1, 0xf1, 0xff, 
                                           0xe3, 0x91, 0xe0, 0x5f, 0x4e, 0xf1, 0xf1, 0x6, 0x14, 0x18, 0x5, 0x0])
        scriptingBlock2.script[87].scriptData[209] = 0x2f
        scriptingBlock1.script[79].scriptData[2] = 0x1
        scriptingBlock1.script[79].scriptData[9] = 0x22
        scriptingBlock1.script[79].scriptData[11] = 0x3
        scriptingBlock1.script[79].scriptData[12] = 0x3
        mapHeaders.header[39].npcs[0][1] = 0x3
        scriptingBlock1.script[28].scriptData[2] = 0x33
        scriptingBlock2.script[78].scriptData[17] = 0x4
        scriptingBlock2.replaceScript(46, [0x4b, 0xb3, 0xf3, 0x6, 0xc0, 0xdc, 0x59, 0xe7, 0x52, 0x93, 0x55, 0xdf, 0xd7, 0x6, 0xde, 0x88, 0xea, 0x61, 0x84, 
                                           0xf0, 0xff, 0x15, 0xc, 0x0, 0x19, 0x1, 0x34, 0x0, 0x0])
        scriptingBlock2.replaceScript(47, [0x20, 0x1f, 0x5, 0xf5, 0xbd, 0x5b, 0x6d, 0x9a, 0xde, 0x88, 0xea, 0x6, 0x58, 0xe1, 0xec, 0x50, 0x56, 0x9b, 0xd4, 
                                           0xd5, 0x55, 0xe7, 0x6, 0x4f, 0x51, 0x9c, 0xba, 0xc0, 0xc2, 0xf4, 0x6, 0xc4, 0xdc, 0xf5, 0xd0, 0x6a, 0x54, 0xea, 
                                           0xdc, 0x67, 0x6f, 0x55, 0x6, 0x83, 0x5b, 0xea, 0x87, 0xdb, 0x4f, 0x51, 0xe0, 0xf4, 0x6, 0xff, 0xbb, 0x4e, 0x7b, 
                                           0x71, 0xd7, 0xf4, 0x6, 0x20, 0x1f, 0x6, 0xf5, 0xc7, 0x5b, 0xea, 0xd4, 0xec, 0xf3, 0x6, 0xff, 0x20, 0x1f, 0x5, 
                                           0x77, 0x7e, 0x60, 0x51, 0x68, 0x5f, 0x6, 0x62, 0xe2, 0x56, 0x9b, 0xd4, 0xd9, 0x7f, 0x68, 0xc6, 0xba, 0xc0, 0xc2, 
                                           0xf0, 0xff, 0xd0, 0xd8, 0xee, 0x5a, 0x8a, 0xe2, 0xe2, 0xde, 0x56, 0xda, 0x6, 0x7e, 0x66, 0x61, 0xdc, 0xe0, 0xf0, 
                                           0x6, 0xc4, 0xdc, 0xf5, 0x99, 0x60, 0x64, 0x59, 0x5e, 0x87, 0xdb, 0x6, 0x58, 0x61, 0x60, 0x69, 0xe1, 0xf4, 0x6, 
                                           0x20, 0x1f, 0x5, 0xf5, 0xbd, 0x5b, 0x6d, 0x9a, 0xde, 0x88, 0xea, 0xf4, 0x6, 0xff, 0xd0, 0x51, 0x5a, 0x83, 0xdc, 
                                           0x57, 0x51, 0x62, 0xe2, 0xf4, 0x6, 0xc4, 0xdc, 0xf5, 0xc1, 0x4e, 0xd7, 0x91, 0xe3, 0xe3, 0x8f, 0x5c, 0xe1, 0xef, 
                                           0x6, 0x58, 0xe6, 0xde, 0x8f, 0x64, 0x4e, 0xd4, 0xd5, 0x55, 0xe7, 0x6, 0x9c, 0xba, 0xc0, 0xc2, 0xef, 0x58, 0x7c, 
                                           0x8a, 0xd8, 0xd9, 0xe7, 0xf0, 0x6, 0x20, 0x1f, 0x5, 0xf5, 0xc8, 0xdb, 0xf1, 0xf1, 0xff, 0xc8, 0xde, 0xd4, 0xec, 0xf0, 
                                           0x6, 0xff, 0x99, 0x59, 0xde, 0xe6, 0xf1, 0xb, 0xd, 0x19, 0xf1, 0x10, 0xff, 0xc4, 0xdc, 0xf5, 0xd0, 0xd4, 0x87, 0xf3, 
                                           0x6, 0x19, 0xf1, 0x11, 0xff, 0x11, 0x8, 0xc4, 0xdc, 0xf5, 0xc9, 0xd8, 0xe2, 0xe3, 0x98, 0x63, 0xd4, 0x72, 0x50, 0x60, 
                                           0x4f, 0x51, 0x5a, 0x58, 0x5a, 0x9c, 0xba, 0xc0, 0xc2, 0x6, 0x5c, 0x73, 0x50, 0x4e, 0x5a, 0xdf, 0xdc, 0xd6, 0x52, 0x8d, 
                                           0x6, 0x4f, 0x51, 0x58, 0xe1, 0xd6, 0xdc, 0x8b, 0x54, 0x71, 0xd7, 0xe6, 0xf0, 0x8c, 0xe7, 0x77, 0xff, 0xb4, 0x4f, 0x5b, 
                                           0x50, 0xd8, 0x6, 0xff, 0x75, 0x78, 0x58, 0x7c, 0xff, 0xb3, 0x4f, 0x5b, 0x50, 0xd8, 0x6, 0x63, 0x55, 0x50, 0x7e, 0x91, 
                                           0xe0, 0x4f, 0x51, 0x6, 0xff, 0xbb, 0xdc, 0x9b, 0xcb, 0xe2, 0xd6, 0xde, 0x5c, 0x73, 0x50, 0xd8, 0x6, 0xff, 0xcc, 0x55, 
                                           0x50, 0x53, 0x73, 0xbf, 0x66, 0xd8, 0x78, 0xf0, 0xb, 0x14, 0x1, 0x3, 0x10, 0x0])
        scriptingBlock2.replaceScript(48, [0x6, 0xff, 0xd0, 0x6a, 0xe7, 0xf4, 0x6, 0xff, 0xba, 0x93, 0x7d, 0xd4, 0x77, 0x64, 0x8b, 0x4f, 0xe2, 0xe2, 0xde, 0x6, 
                                           0x4f, 0x51, 0x9c, 0xba, 0xc0, 0xc2, 0xf4, 0x6, 0x20, 0x1f, 0x5, 0xf5, 0xd0, 0x4e, 0x6e, 0x4e, 0x71, 0x56, 0xda, 0x6, 
                                           0x4f, 0x5b, 0x50, 0x4e, 0xba, 0x93, 0x7d, 0xd4, 0x77, 0x6, 0xff, 0xbb, 0x89, 0xd8, 0xf0, 0x6, 0xc4, 0xdc, 0xf5, 0xc2, 
                                           0xee, 0xe0, 0x7a, 0x81, 0x56, 0x9b, 0xea, 0x87, 0xdb, 0x6f, 0x55, 0xf0, 0x8c, 0x64, 0x8e, 0x54, 0xe6, 0xd4, 0x76, 0x6, 
                                           0x4f, 0x70, 0x52, 0xea, 0x66, 0xdf, 0x57, 0xd9, 0x91, 0xe0, 0x6, 0xff, 0xba, 0x93, 0x7d, 0xd4, 0xf0, 0xb, 0xd, 0x14, 
                                           0x1, 0x7, 0x14, 0x0, 0x2, 0x10, 0x19, 0x0, 0xf, 0x0])
        scriptingBlock2.replaceScript(56, [0xc4, 0xdc, 0xf5, 0xc2, 0xee, 0x67, 0x61, 0x75, 0x96, 0x6d, 0xe8, 0xf3, 0x6, 0x19, 0x1, 0x7c, 0xff, 0xc8, 0xde, 0xd4, 
                                           0xec, 0xf3, 0xff, 0xba, 0x67, 0x83, 0x65, 0xd8, 0xf3, 0xf3, 0x6, 0x15, 0x1, 0x56, 0x19, 0x1, 0x30, 0x0, 0x15, 0x1, 
                                           0x2, 0x19, 0x1, 0x2f, 0x0, 0x0])
        scriptingBlock2.insertIntoScript(52, 0, [0x12, 0xc])

    def convertToRealChests(scriptingBlock1:FFL2R_io.ScriptBlock, mapHeaders:FFL2R_io.MapData, treasureFlags:list):
        scriptingBlock1.replaceScript(38, [0x1b, 0xa, 0x19, 0x0, 0x5b, 0x0, 0x19, 0x5, 0xb4, 0x19, 0x7, 0xe, 0xc2, 0xe7, 0x77, 0x4f, 0xe2, 0x5b, 0xd5, 0xe5, 
                                            0xdc, 0xda, 0xdb, 0xe7, 0xf3, 0x6, 0x79, 0x97, 0xe1, 0x88, 0x54, 0x80, 0xd8, 0x6, 0x59, 0xec, 0x50, 0x56, 0xda, 
                                            0xf3, 0xf3, 0x0])
        scriptingBlock1.replaceScript(91, [0x19, 0x5, 0xb5, 0x19, 0xf0, 0x12, 0x19, 0x7, 0xb, 0x36, 0x3, 0xcc, 0xd8, 0x4e, 0xea, 0xd8, 0x67, 0x5e, 0x87, 0xdb, 
                                           0x6, 0x36, 0x3, 0x9e, 0xff, 0xcd, 0xe5, 0xe8, 0x4e, 0xbe, 0xec, 0x4e, 0xf3, 0xf3, 0x0])
        mapHeaders.header[65].npcs[2] = [0x80, treasureFlags[0], 0x20, 0xd9, 0xa, 0xfa]
        treasureFlags.pop(0)
        scriptingBlock1.replaceScript(86, [0x0])

    def venusWorldCleanup(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock, memoBlock:FFL2R_io.ScriptBlock, 
                          mapHeaders:FFL2R_io.MapData):
        scriptingBlock1.insertIntoScript(165, 0, [0x15, 0x8, 0x1, 0x14, 0x8, 0x2, 0x31])
        scriptingBlock2.removeFromScript(176, 91, 94)
        mapHeaders.header[102].npcs[0][1] = 0x0
        scriptingBlock2.removeFromScript(165, 0, 2)
        scriptingBlock2.insertIntoScript(165, 0, [0x15, 0x8, 0x1])
        scriptingBlock2.removeFromScript(157, 6, 13)
        scriptingBlock2.insertIntoScript(157, 6, [0x0, 0x15, 0x8, 0x11, 0x19, 0x1, 0xf6, 0x0])
        memoBlock.removeFromScript(241, 390, 392)
        memoBlock.insertIntoScript(241, 390, [0x15, 0x11, 0x0])
        memoBlock.insertIntoScript(241, 504, [0x13, 0x11, 0x12, 0x10])
        scriptingBlock2.insertIntoScript(164, 0, [0x12, 0x11])
        scriptingBlock2.removeFromScript(159, 51, 53)
        scriptingBlock2.insertIntoScript(159, 51, [0x15, 0x11, 0x0])

    #stitches together Dad's death cutscene by putting it all into memo
    def dadDeathCutscenes(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock, memoBlock:FFL2R_io.ScriptBlock):
        memoBlock.replaceScript(244, scriptingBlock2.script[152].scriptData)
        scriptingBlock2.removeFromScript(116, 211, 218)
        scriptingBlock2.insertIntoScript(116, 0, [0x10])
        memoBlock.insertIntoScriptAtEnd(244, scriptingBlock2.script[116].scriptData)
        memoBlock.removeFromScript(244, len(memoBlock.script[244].scriptData)-5, len(memoBlock.script[244].scriptData))
        scriptingBlock2.insertIntoScriptAtEnd(115, [0x12, 0x10, 0x19, 0x5, 0xed, 0x15, 0x5, 0x0, 0x14, 0x4, 0x0, 0x0, 0x15, 0x5, 0x11, 0x14, 0x4, 0x1, 
                                                    0x0, 0x15, 0x5, 0x33, 0x14, 0x4, 0x1, 0x0])
        memoBlock.insertIntoScriptAtEnd(244, scriptingBlock2.script[115].scriptData)
        #+ 
        scriptingBlock2.replaceScript(115, [0x0])
        scriptingBlock2.replaceScript(116, [0x0])
        scriptingBlock2.replaceScript(152, [0x4b, 0xf4, 0x40, 0xf4, 0x0])
        scriptingBlock2.insertIntoScriptAtEnd(236, [0x12, 0x5, 0x15, 0x5, 0x44, 0x12, 0x10, 0x12, 0x5, 0x0])
        scriptingBlock1.insertIntoScriptAtEnd(89, [0x15, 0x5, 0x12, 0x12, 0x5, 0x12, 0x5, 0x15, 0x5, 0x44, 0x12, 0x10, 0x12, 0x5, 0x0])
        scriptingBlock2.insertIntoScriptAtEnd(94, [0x12, 0x5])

    def nastyChest(scriptingBlock1:FFL2R_io.ScriptBlock, mapHeaders:FFL2R_io.MapData):
        #29
        scriptingBlock1.replaceScript(82, [0x15, 0x11, 0x11, 0x19, 0x0, 0x53, 0xe, 0x19, 0xf0, 0x0, 0xff, 0x14, 0x11, 0x1, 0x14, 0x1e, 0x2, 0x19, 0x7, 0xd, 0x0])
        scriptingBlock1.replaceScript(93, [0x14, 0x1e, 0x3, 0x14, 0x11, 0x0, 0x15, 0xd, 0x28, 0x14, 0x1e, 0x1, 0x31, 0x0])
        scriptingBlock1.removeFromScript(142, 313, 315)
        mapHeaders.header[202].npcs[1] = [0x1d, 0x0, 0x4, 0xc6, 0x5e, 0xf0]
        scriptingBlock1.replaceScript(94, [0x12, 0x1d, 0x12, 0x10, 0x12, 0x11, 0x10, 0x13, 0x11, 0x19, 0xa, 0xc, 0x0])

    def magiCheckRedo(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock,mapHeaders:FFL2R_io.MapData, treasureFlagReclaim:list):
       #scriptingBlock1.replaceScript(47, [0x12, 0x10, 0x10, 0x06, 0x36, 0x05, 0xC8, 0xE3, 0x8B, 0x8F, 0xF3, 0x0B, 0x0D, 0x19, 0xF0, 
       #                                    0x01, 0xFF, 0x00])
        doorLocks = {
                23 : 0x00, #to giant world, map 23
                40 : 0x01, #to apollo world 40
                56 : 0x02, #to guardian world map 56
                84 : 0x03, #to ninja world map 84
                100 : 0x04, #to venus world map 100
                103 : 0x05, #to race world map 103
                125 : 0x06, #to edo map 125
                136 : 0x07, #to nasty dungeon world map 136
                161 : 0x08, #to valhalla map 161
                #172 needs an npc to check against
                #174 : 0x0c, #to central world map 174 npc14
                }
        #most var16 incs are in the respective rescript events. 
        mapHeaders.remNPC(15,4)
        scriptingBlock1.replaceScript(24, [0x0])
        mapHeaders.remNPC(39,1)
        scriptingBlock1.replaceScript(68, [0x0])
        scriptingBlock2.insertIntoScriptAtEnd(144, [0x12, 0x10])
        scriptingBlock2.insertIntoScriptAtEnd(212, [0x12, 0x10])
        scriptingBlock1.insertIntoScriptAtEnd(132, [0x12, 0x10])
        mapHeaders.addNPC(172, 0, [0x50, 0xA, 0xe0, 0xc1, 0x35, 0xf0])
        mapHeaders.remNPC(175, 0)
        scriptingBlock1.replaceScript(53, [0x1a, 0x4b, 0x19, 0x0, 0x44, 0x0, 0x19, 0x0, 0x45, 0x0])
        scriptingBlock1.replaceScript(68, [0xff, 0x36, 0x3, 0xd0, 0x4e, 0x92, 0x8f, 0xff, 0xb7, 0xb6, 0x6, 0x36, 0x3, 0xc6, 0xba, 0xc0, 0x79, 0x5d, 0x69, 0xe3, 0x8b, 0x6, 0x36, 0x4, 0x50, 
                                           0x5f, 0x83, 0xe2, 0x66, 0xf3, 0x0])
        scriptingBlock1.replaceScript(69, [0x14, 0x10, 0xb, 0x10, 0x6, 0x36, 0x5, 0xc8, 0xe3, 0x8b, 0x8f, 0xf3, 0xb, 0xd, 0x19, 0xf0, 0x1, 0xff, 0x0, 0x0])
        scriptingBlock1.replaceScript(70, [0xff, 0xd0, 0x4e, 0xe0, 0x8e, 0x54, 0xd6, 0x81, 0xe3, 0x98, 0x7f, 0x6, 0x58, 0x67, 0x69, 0x50, 0x53, 0x5e, 0x66, 0xdf, 0xd7, 0xe6, 0x6, 0x5d, 
                                           0x69, 0xe3, 0x8b, 0x4f, 0x70, 0x52, 0xd7, 0xe2, 0x66, 0xf3, 0x0])
        scriptingBlock1.replaceScript(72, [0x0])
        scriptingBlock1.replaceScript(73, [0x0])
        scriptingBlock1.replaceScript(74, [0x0])
        scriptingBlock1.replaceScript(75, [0x0])
        scriptingBlock1.replaceScript(76, [0x0])
        scriptingBlock1.replaceScript(77, [0x0])

        for k,v in doorLocks.items():
            mapHeaders.header[k].npcs[0][1] = v
            mapHeaders.header[k].npcs[0][4] = 0x0
            mapHeaders.header[k].npcs[0][5]+=0x1

        #map 174/final world pillar door should use var12 w/ fake chest at WarMech to increment and reward final magi
        mapHeaders.header[174].npcs[14] = [0x4c, 0x4, 0xe0, 0xdc, 0x0, 0xf1]
        treasureFlagReclaim.append(38)
        mapHeaders.header[187].npcs[1] = [0xc, 0x4, 0xc, 0xcc, 0x47, 0xf0]
        mapHeaders.addNPC(187, 0, [0x11, 0x11, 0x4c, 0xcc, 0x3, 0xf1])
        scriptingBlock1.replaceScript(71, [0x12, 0xc, 0x12, 0x11, 0x10, 0x13, 0x11, 0x19, 0xa, 0xb, 0x0])


class Utility:
    def __init__(self):
        pass

    def dteTranslate(strList:list)->str:
        result = ""
        for char in strList:
            try:
                result = result + (FFL2R_data.GameData.dteLookup[char])
            except:
                result = result + " " + (str(char))
        return result

    def listToHex(intList:list)->list:
        return [hex(x) for x in intList]

    def setBoundaries(num:int, floor:int, ceiling:int) -> int:
        if num < floor:
            num = floor
        elif num > ceiling:
           num = ceiling
        return num

    def findCoordinate(byte:int)->int:
        return ((byte & 0x3f) | (((byte & 0x3f) >> 4) << 4))

    def remainingBytes(byte:int, sub:int)->int:
        return ((byte - sub) & 0xf0) >> 6

    def findVar(scriptingBlock1:FFL2R_io.ScriptBlock, scriptingBlock2:FFL2R_io.ScriptBlock, memoBlock:FFL2R_io.ScriptBlock, 
                mapHeaders:FFL2R_io.MapData, byteStr:list):
         print(f"""
    var-inc 1:{scriptingBlock1.findScriptsByBytes([0x12] + byteStr)}
    var-inc 2:{scriptingBlock2.findScriptsByBytes([0x12] + byteStr)}
    var-inc m:{memoBlock.findScriptsByBytes([0x12] + byteStr)}
    var-dec 1:{scriptingBlock1.findScriptsByBytes([0x13] + byteStr)}
    var-dec 2:{scriptingBlock2.findScriptsByBytes([0x13] + byteStr)}
    var-inc m:{memoBlock.findScriptsByBytes([0x13] + byteStr)}
    var-set 1:{scriptingBlock1.findScriptsByBytes([0x14] + byteStr)}
    var-set 2:{scriptingBlock2.findScriptsByBytes([0x14] + byteStr)}
    var-inc m:{memoBlock.findScriptsByBytes([0x14] + byteStr)}
    var-test 1:{scriptingBlock1.findScriptsByBytes([0x15] + byteStr)}
    var-test 2:{scriptingBlock2.findScriptsByBytes([0x15] + byteStr)}
    var-inc m:{memoBlock.findScriptsByBytes([0x15] + byteStr)}
    NPCs: {mapHeaders.findNPCs(0,byteStr)}""")